<!doctype html>
<html lang="ru">
  <head>
    @@include('./_head.html')
  </head>

  <body>
    <section class="hero is-fullheight">
      <!-- Шапка -->
      @@include('./components/header/header.html')
      <!-- /END Шапка -->

      <main class="hero-body is-align-items-start">
        <div class="container">
          <!-- Главная страница-->
          {% IF index_page %} @@include('./pages/index/index.html') {% ENDIF %}

          <!-- Основная часть -->
          {% IFNOT index_page %}

          <!-- Хлебные крошки -->
          @@include('./components/breadcrumbs/breadcrumbs.html')
          <!-- /END Хлебные крошки -->

          <!-- Центральный блок-->
          {% IF MOD_LNAME = goods || MOD_LNAME = cart || MOD_LNAME = feedback %}
          {% IF MOD_LNAME = cart %}
          <div class="col-center col">
            <div id="root"></div>

            <script type="module">
              import React, { useState } from 'react';
              import { createRoot } from 'react-dom/client';
              import {
                QueryClient,
                QueryClientProvider,
                useQuery,
              } from '@tanstack/react-query';
              import { ReactQueryDevtools } from '@tanstack/react-query-devtools';

              const queryClient = new QueryClient();

              function App() {
                const [count, setCount] = useState(0);

                const { data, isLoading, isError } = useQuery({
                  queryKey: ['time', count],
                  queryFn: async () => {
                    const res = await fetch('https://worldtimeapi.org/api/ip');
                    return res.json();
                  },
                });

                if (isLoading) return <p>Загрузка...</p>;
                if (isError) return <p>Ошибка при загрузке данных</p>;

                return (
                  <div style={{ fontFamily: 'sans-serif', padding: '20px' }}>
                    <h1>React + TanStack Query</h1>
                    <p>
                      <b>Текущее время:</b> {data.datetime}
                    </p>
                    <button
                      onClick={() => setCount((c) => c + 1)}
                      style={{
                        padding: '8px 14px',
                        borderRadius: '8px',
                        border: '1px solid #ccc',
                        background: '#f5f5f5',
                        cursor: 'pointer',
                      }}
                    >
                      Обновить
                    </button>

                    {/* Панель Devtools */}
                    <ReactQueryDevtools initialIsOpen={true} />
                  </div>
                );
              }

              const root = createRoot(document.getElementById('root'));
              root.render(
                <QueryClientProvider client={queryClient}>
                  <App />
                </QueryClientProvider>
              );
            </script>
            <div id="root-cart"></div>
            <script>
              window.CART = JSON.parse(`{BODY}`);
            </script>
          </div>
          {% ELSE %} {BODY} {% ENDIF %} {% ELSE %}
          <div class="columns">
            <!-- Левый блок -->
            <div class="column is-one-quarter">
              @@include('./components/sidebar/sidebar.html')
            </div>
            <!-- Основной контент -->
            <div class="column">
              <!-- Заголовок страницы -->
              @@include('./components/page-title/page-title.html')
              <!-- /END Заголовок страницы -->

              {BODY}
            </div>
          </div>
          {% ENDIF %} {% ENDIF %}
        </div>
      </main>
      <!-- /END Основная часть -->

      <!-- Подвал -->
      @@include('./components/footer/footer.html')
      <!-- /END Подвал -->
    </section>

    <!-- SEO -->
    @@include('./components/SEO/index.html')
    <!-- /END SEO -->

    <!-- Скрипты -->
    @@include('./_scripts.html')
    <!-- /END Скрипты -->
  </body>
</html>
